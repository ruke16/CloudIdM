## Running the first cloud network

Before you can deploy the cloud network, you need to follow the instructions to [Install the Samples, Binaries and Docker Images](https://hyperledger-fabric.readthedocs.io/en/latest/install.html) in the Hyperledger Fabric documentation. All commands are invoked from relevant directory in cloud-network.

1. Execute ```./network.sh up```.
    - The above command will create two Organization CSP 1 and CSP 2. With one orderer and consortium created. Certificates are generated by fabric CA/ cyptogen.

2. Execute ```./network.sh createChannel -c cloudchannel```
    - A channel is created. Default name of channel is cloudchannel.

3. Execute ```cd addCSP3```.
4. Execute ```./addCSP3.sh up``` 
    - The command creates CSP 3 and adds the organization to the cloudchannel channnel.

5. To deploy the cloud chaincode on cloudchannel, 
    - First up the network with couchdb using command - ```./network.sh up createChannel -c cloudchannel -s couchdb```
    - Deploy chaincode cloud ```./network.sh deployCC -c cloudchannel -ccn cloud -ccv 1 -cci initLedger```
    - Then Execute following commands - 
    	export PATH=${PWD}/../bin:$PATH
	export FABRIC_CFG_PATH=$PWD/../config/
	export CORE_PEER_TLS_ENABLED=true
	export CORE_PEER_LOCALMSPID="CSP1MSP"
	export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/CSP1.cloud.com/peers/peer0.CSP1.cloud.com/tls/ca.crt
	export CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/CSP1.cloud.com/users/Admin@CSP1.cloud.com/msp
	export CORE_PEER_ADDRESS=localhost:7051
    - If initLedger argument is added in deployCC command, then ignore the following command. If not, execute this statement
      peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.cloud.com --tls --cafile ${PWD}/organizations/ordererOrganizations/cloud.com/orderers/orderer.cloud.com/msp/tlscacerts/tlsca.cloud.com-cert.pem -C cloudchannel -n patient --peerAddresses localhost:7051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/CSP1.cloud.com/peers/peer0.CSP1.cloud.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/CSP2.cloud.com/peers/peer0.CSP2.cloud.com/tls/ca.crt --peerAddresses localhost:11051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/CSP3.cloud.com/peers/peer0.CSP3.cloud.com/tls/ca.crt -c '{"function":"initLedger","Args":[]}'

6. Sample query - peer chaincode query -C cloudchannel -n cloud -c '{"Args":["readcloud","cloud1"]}'
7. To bring the network down 
    - ```./addCSP3 down```

## Troubleshooting
If errors like orderer keeps shutting down or a message like 
```!!!!!!!!!!!!!!! Fetching config block from orderer has Failed !!!!!!!!!!!!!!!!```. A initial research as of now is the docker image has been damaged. 

So execute the following command 
```docker stop $(docker ps -a -q)  ; docker rm -f $(docker ps -aq) ; docker system prune -a ; docker volume prune ; docker ps -a ; docker images -a ; docker volume ls```
WARNING: THIS WILL DELETE ALL DOCKER IMAGES, CACHES AND CONTAINERS

Once yo have executed the above command, install just the Docker images again. And execute the network scripts.
